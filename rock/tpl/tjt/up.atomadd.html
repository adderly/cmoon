<div class="infoform">
  <div class="overlaytitle">添加商品</div>
  
  <input id="atomimg" type="hidden" value="" />
  <ul>
	<li>
	  <div class="leftitem">商品图片:</div>
	  <img id="previewimg" src="http://img.eol.com/tjt/ori/default.jpg" width="150" height="80" />
	</li>

	<li>
	  <div class="leftitem">商品描述:</div>
	  <textarea id="atomexp" class="VAL_APPEND vrequire" vmax="1024" rows="5" cols="20"></textarea>
	</li>

	<li>
	  <div class="leftitem"> &nbsp; </div>
	  <input id="addatom" type="button" class="submitbtn" value="提交" />
	</li>
  </ul>
</div>

<script type="text/javascript">
(function() {
    var uri = window.location;
	var button = $("#previewimg");
	var uploader = new AjaxUpload(button,
	{
		action: uri,
		name: 'imagename',
		data: {op: 'add', tp: 'imageadd'},
		responseType: "json",
		autoSubmit: true,
		onChange: replaceImage,
		onComplete: function(file, resp) {
			if (jsonCbkSuc(resp, {suctip: false})) {
				$("#previewimg").attr("src", resp.imageurl);
				$("#atomimg").val(resp.imagename);
			}
		}
	});

	function replaceImage(file, ext) {
		if (! (ext && /^(jpg|png|jpeg|gif)$/.test(ext))) {
			alert("请选择图片");
			return false;
		}
		return true;
	}

	$("#addatom").click(function()
	{
		if (!$(".VAL_APPEND").inputval()) {
			return;
		}

		$.post(uri,
			   {
				   img: $("#atomimg").val(),
				   exp: $("#atomexp").val(),
				   op: 'add'
			   },
			   function(data) {
				   if (jsonCbkSuc(data, {rurl: uri}))
					   overlay_append.close();
			   }, "json");
	});
})();
</script>
